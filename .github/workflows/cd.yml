name: ğŸš€ Continuous Deployment - Render

on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Deploy to Render
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ” Checkout repositÃ³rio
        uses: actions/checkout@v4

      - name: ğŸ§© Configurar Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: "npm"

      - name: ğŸ“¦ Instalar dependÃªncias
        run: npm ci

      - name: ğŸ§ª Rodar testes
        run: npm test

      - name: ğŸš€ Deploy no Render
        if: success()
        # run: | teste cd 2
        #   echo "Iniciando deploy no Render..."
        #   echo "Chamando  webhook de deploy remoto..."
        #   curl -X POST "${{ secrets.RENDER_DEPLOY_HOOK }}" --fail -s -o /dev/null
        #   echo "âœ… Deploy disparado com sucesso!"
        # shell: bash
        run: |
          echo "Iniciando deploy no Render..."
          echo "Verificando variÃ¡vel RENDER_DEPLOY_HOOK..."
          echo "${{ secrets.RENDER_DEPLOY_HOOK }}" | head -c 60
          echo ""
          curl -X POST "${{ secrets.RENDER_DEPLOY_HOOK }}" --fail -s -o /dev/null
          echo "âœ… Deploy disparado com sucesso!"
        shell: bash